@page "/configuration"

@using MudBlazor
@using Alkampfer.Assistant.Core.Configuration
@inherits ConfigurationPage

<PageTitle>Configuration</PageTitle>

<h1>Configuration</h1>

<MudPaper Class="pa-4">
    <MudText Typo="Typo.h6">Add Model Definition</MudText>
    <MudTextField @bind-Value="NewModelDefinition.Url" Label="URL" Variant="Variant.Outlined" Class="my-2" />
    <MudTextField @bind-Value="NewModelDefinition.ApiKey" Label="API Key" Variant="Variant.Outlined" Class="my-2" />
    <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="@(() => AddModelDefinitionAsync())">Add Model Definition</MudButton>

    <MudDivider Class="my-4" />
    <MudText Typo="Typo.h6">Model Definitions</MudText>
    <MudList Class="mt-4" T="ModelDefinition">
        @foreach (var modelDef in ModelDefinitions)
        {
            <MudListItem T="ModelDefinition">
                <MudText>Url: @modelDef.Url</MudText>
                <MudText>ApiKey: @modelDef.ApiKey</MudText>
                <MudButton Variant="Variant.Outlined" Color="Color.Primary" OnClick="@(() => StartAddModelConfig(modelDef.Id!))">Add Model</MudButton>
                <MudIconButton Icon="@Icons.Material.Filled.Delete" Color="Color.Error" OnClick="@(() => RemoveModelDefinitionAsync(modelDef.Id!))" />
                <MudList Class="ml-4 mt-2" T="ModelConfiguration">
                    @for (int i = 0; i < modelDef.Models.Count; i++)
                    {
                        var model = modelDef.Models[i];
                        var modelIndex = i; // Capture for closure
                        <MudListItem T="ModelConfiguration">
                            <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                                <MudText>Model: @model.ModelName - @model.ModelDescription</MudText>
                                <MudIconButton Icon="@Icons.Material.Filled.Delete" Color="Color.Error" Size="Size.Small" OnClick="@(() => RemoveModelConfigAsync(modelDef.Id!, modelIndex))" />
                            </div>
                        </MudListItem>
                    }
                </MudList>
                @if (EditingModelId == modelDef.Id)
                {
                    <MudTextField @bind-Value="NewModelConfig.ModelName" Label="Model Name" Variant="Variant.Outlined" Class="my-2" />
                    <MudTextField @bind-Value="NewModelConfig.ModelDescription" Label="Description" Variant="Variant.Outlined" Class="my-2" />
                    <div>
                        <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="AddModelConfigAsync">Add</MudButton>
                        <MudButton Variant="Variant.Outlined" Color="Color.Secondary" OnClick="CancelAddModelConfig" Class="ml-2">Cancel</MudButton>
                    </div>
                }
            </MudListItem>
        }
    </MudList>
</MudPaper>
